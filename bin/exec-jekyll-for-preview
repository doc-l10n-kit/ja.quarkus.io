#!/usr/bin/env bash
set -eu

#
# This script calls jekyll. `/translated` directory need to be filled beforehand.
#

SCRIPT_DIR=$(cd $(dirname $0); pwd)
L10N_HOME=$(cd $(dirname $SCRIPT_DIR); pwd)
cd $L10N_HOME

export TARGET_LANG=`jq ".targetLang" config/l10n-kit.json -r`

cd translated/$TARGET_LANG

bundle config set --local path "$L10N_HOME/vendor/bundle"
if ! bundle list | grep asciidoctor-l10n ; then
  bundle add 'asciidoctor-l10n' --group jekyll_plugins --git https://github.com/doc-l10n-kit/asciidoctor-l10n --branch main
fi
bundle install
bundle exec jekyll build -d $L10N_HOME/docs/ --config _config.yml,_only_latest_guides_config.yml

rm $L10N_HOME/docs/CNAME
