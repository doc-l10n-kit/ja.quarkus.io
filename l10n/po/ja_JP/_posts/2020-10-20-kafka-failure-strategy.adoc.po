msgid ""
msgstr ""
"Language: ja_JP\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"X-Generator: doc-l10n-kit"

#. type: YAML Front Matter
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:2
msgid "post"
msgstr "post"

#. type: YAML Front Matter
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:3
#, fuzzy
msgid "Kafka - How to fail gracefully"
msgstr "Kafka - 優雅に失敗する方法"

#. type: YAML Front Matter
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:4
#, fuzzy
msgid "2020-10-20"
msgstr "2020-10-20"

#. type: YAML Front Matter
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:5
msgid "reactive kafka"
msgstr "reactive kafka"

#. type: YAML Front Matter
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:6
#, fuzzy
msgid "Failure handling in the Kafka connector"
msgstr "Kafkaコネクタの障害処理について"

#. type: YAML Front Matter
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:7
msgid "cescoffier"
msgstr "cescoffier"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:10
#, fuzzy
msgid ""
"Failures are inevitable.\n"
"There is nothing we can do about that, and that also applies to Kafka applications.\n"
"Your application may contain a faulty component misbehaving once in a while, or unable to process a specific Kafka record.\n"
"In this post, we are going to see how we can manage these failures."
msgstr "失敗は避けられない。それはどうしようもないことで、Kafkaアプリケーションにも当てはまります。あなたのアプリケーションには、たまに誤動作する不良コンポーネントが含まれていたり、特定のKafkaレコードを処理できないことがあります。この記事では、これらの障害をどのように管理できるかを見ていきます。"

#. type: Title ==
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:15
#, fuzzy
msgid "Ack and Nack"
msgstr "アックとナック"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:17
#, fuzzy
msgid ""
"But, first, we need to explain how it works under the hood.\n"
"When using reactive messaging, your application receives https://smallrye.io/smallrye-reactive-messaging/smallrye-reactive-messaging/2.4/concepts.html#messages[Messages].\n"
"Even if your method handles _payloads_, there are Messages under the hood, and it unwraps the payload just before calling your method."
msgstr "しかし、その前に、フードの下でどのように動作するかを説明する必要があります。リアクティブ・メッセージングを使用する場合、アプリケーションは link:https://smallrye.io/smallrye-reactive-messaging/smallrye-reactive-messaging/2.4/concepts.html#messages[Messageを] 受け取ります。あなたのメソッドが _ペイロードを_ 処理するとしても、フードの下にはMessageがあり、あなたのメソッドを呼び出す直前にペイロードをアンラップする。"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:21
#, fuzzy
msgid "image:/assets/images/posts/kafka-failure-strategy/messages.png[]"
msgstr "image:/assets/images/posts/kafka-failure-strategy/messages.png[alt=\"messages\"]"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:23
#, fuzzy
msgid ""
"A message can be _acked_ or _nacked_.\n"
"If the message processing completes successfully, the message is acknowledged.\n"
"You can manually trigger the acknowledgment (by calling the `ack()` method) or let the framework handle it automatically.\n"
"In general, it's the outbound connector that acknowledges the message once the outgoing message has been sent to the broker successfully.\n"
"If not configured otherwise, acknowledging a message acknowledges the _source_ message, acknowledging its source, until we reach the root message, most probably created by an inbound connector:"
msgstr "メッセージは、 _acked_ または _nacked_ することができます。メッセージの処理が正常に完了した場合、メッセージは承認されます。確認応答を手動でトリガーする（ `ack()` メソッドを呼び出す）か、フレームワークに自動処理させることができます。一般的に、送信メッセージがブローカーに正常に送信されると、メッセージを確認するのは送信コネクタです。他に設定されていない場合、メッセージの確認応答は、ルートメッセージ（おそらくインバウンドコネクタによって作成された）に到達するまで、 _ソース_ メッセージを確認し、そのソースを確認する："

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:29
#, fuzzy
msgid "image:/assets/images/posts/kafka-failure-strategy/ack-chain.png[Acknowledgement chain]"
msgstr "image:/assets/images/posts/kafka-failure-strategy/ack-chain.png[alt=\"Acknowledgement chain\"]"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:31
#, fuzzy
msgid ""
"When the inbound connector receives the acknowledgment, it can act upon it and, for example, indicate to the broker that the message processing succeeded.\n"
"In the context of Kafka, there are various commit strategies.\n"
"We will cover these in a future post."
msgstr "インバウンドコネクターが確認応答を受け取ると、それをもとに行動し、たとえばブローカーにメッセージ処理が成功したことを示すことができます。Kafkaの文脈では、さまざまなコミット戦略があります。これらについては、今後の記事で取り上げる予定です。"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:35
#, fuzzy
msgid ""
"But as said earlier, failures are inevitable.\n"
"For example, you may have a misbehaving component throwing exceptions, or the outbound connector cannot send the messages because the remote broker is unavailable.\n"
"In these cases, the message is _nacked_, indicating that the processing failed.\n"
"Similarly to successful acknowledgment, negative acknowledgment can be triggered manually (using the `nack` method) or handled automatically.\n"
"For example, if your method throws an exception, the message is nacked.\n"
"As with _ack_, nacking a message nacks its source, and the nack is propagated until the inbound connector:"
msgstr "しかし、先に述べたように、失敗は避けられない。例えば、動作不良のコンポーネントが例外をスローしたり、リモートブローカーが利用できないためにアウトバウンドコネクターがメッセージを送信できなかったりすることがあります。このような場合、メッセージは _ナック_ され、処理に失敗したことを示します。成功した確認と同様に、否定的な確認も手動で（ `nack` メソッドを使用して）トリガーすることも、自動的に処理することも可能です。例えば、メソッドが例外をスローした場合、メッセージはナッキングされます。 _ack_ と同様に、メッセージをナックするとそのソースがナックされ、ナックは受信コネクタまで伝搬されます："

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:42
#, fuzzy
msgid "image:/assets/images/posts/kafka-failure-strategy/nack-chain.png[Negative acknowledgment chain]"
msgstr "image:/assets/images/posts/kafka-failure-strategy/nack-chain.png[alt=\"Negative acknowledgment chain\"]"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:44
#, fuzzy
msgid ""
"It's the responsibility of the connector to decide how to react in this case.\n"
"The Kafka connector proposes three failure handling strategies, and that's what we are going to detail now."
msgstr "この場合、どのように対応するかを決めるのは、コネクタの責任です。Kafkaコネクタは3つの障害処理戦略を提案しており、これから詳しく説明するのはそれだ。"

#. type: Title ==
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:47
#, fuzzy
msgid "The \"Fail-Fast\" strategy"
msgstr "フェイルファスト」戦略"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:48
#, fuzzy
msgid ""
"The first strategy is the simplest, but not sure we can qualify it with \"smoothly.\"\n"
"It's the default strategy.\n"
"As soon as a message is nacked, the connector reports the failure, and the application stops.\n"
"If you use the health checks extension, the application is marked as unhealthy, and your orchestrator may restart the application."
msgstr "最初の戦略は、最もシンプルですが、\"スムーズに \"と修飾子できるかはわかりません。これはデフォルトの戦略です。メッセージがナックされるとすぐに、コネクタは障害を報告し、アプリケーションは停止します。Health Checksエクステンションを使用している場合、アプリケーションは不健康であるとマークされ、オーケストレーターはアプリケーションを再起動することができます。"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:53
#, fuzzy
msgid "image:/assets/images/posts/kafka-failure-strategy/fail-fast.png[Fail-Fast]"
msgstr "image:/assets/images/posts/kafka-failure-strategy/fail-fast.png[alt=\"Fail-Fast\"]"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:55
#, fuzzy
msgid ""
"But, it's time to demonstrate it.\n"
"I've created a simple application receiving movie titles from Kafka and failing (with an exception) if the title contains a `'` or `,`.\n"
"You can check the code on this https://gist.github.com/cescoffier/23ca7b2bcc8c49cee3db29b3f2b59e4a#file-kafkafailfast-java[Gist], or run it using:"
msgstr "しかし、そろそろ実証してみましょう。Kafkaから映画のタイトルを受け取り、タイトルに `'` または `,` が含まれている場合は（例外を除いて）失敗するシンプルなアプリケーションを作りました。この link:https://gist.github.com/cescoffier/23ca7b2bcc8c49cee3db29b3f2b59e4a#file-kafkafailfast-java[Gistで] コードを確認したり、それを使って実行したりすることができます："

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:64
#, fuzzy
msgid ""
"Starting the application starts a Kafka broker using Docker.\n"
"The first start may require downloading the appropriate container image."
msgstr "アプリケーションを起動すると、Dockerを使ってKafkaブローカーが起動する。最初の起動には、適切なコンテナ・イメージをダウンロードする必要があるかもしれない。"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:67
#, fuzzy
msgid "If you ran the application and check the log, you will see:"
msgstr "アプリケーションを実行し、ログをチェックすると、次のように表示される："

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:74
#, fuzzy
msgid "Now, if you open your browser to http://localhost:8080/health, you will see that the failure has been caught and the application is unhealthy:"
msgstr "さて、ブラウザで link:http://localhost:8080/health[http://localhost:8080/health、] 障害が検出され、アプリケーションが不健康になっていることがわかるだろう："

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:101
#, fuzzy
msgid ""
"This approach works well with sporadic, network-related issues.\n"
"Still, if the source of the failure is your application code, you may enter a restart loop.\n"
"Indeed, when the application restarts, it may again receive the message (the red one from the previous picture) that would produce the same failure again and again."
msgstr "この方法は、散発的なネットワーク関連の問題には有効だ。しかし、障害の原因がアプリケーションコードにある場合、再起動のループに入る可能性があります。実際、アプリケーションが再起動すると、同じ失敗を何度も引き起こすようなメッセージ（前の図の赤いもの）を再び受け取るかもしれません。"

#. type: Title ==
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:105
#, fuzzy
msgid "The \"Ignore\" strategy"
msgstr "無視する」戦略"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:106
#, fuzzy
msgid ""
"The second strategy is also straightforward: just close your eyes.\n"
"When a message is nacked, it ignores the failure and continues the processing:"
msgstr "つ目の方法も簡単で、目を閉じていればいい。メッセージがナックされても、失敗を無視して処理を続行する："

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:109
#, fuzzy
msgid "image:/assets/images/posts/kafka-failure-strategy/ignore.png[Ignore strategy]"
msgstr "image:/assets/images/posts/kafka-failure-strategy/ignore.png[alt=\"Ignore strategy\"]"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:111
#, fuzzy
msgid ""
"The log indicates the failure, but it continues the processing with the next one.\n"
"You can only use this strategy if you don't need to manage all the messages or if your application is handling the failure internally."
msgstr "ログには失敗が表示されますが、処理は次のメッセージで続行されます。すべてのメッセージを管理する必要がないか、アプリケーションが内部で失敗を処理している場合にのみ、この方法を使うことができます。"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:114
#, fuzzy
msgid "To enable this strategy, configure the channel with:"
msgstr "このストラテジーを有効にするには、次のようにチャンネルを設定する："

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:121
#, fuzzy
msgid "You can try this strategy with https://gist.github.com/cescoffier/23ca7b2bcc8c49cee3db29b3f2b59e4a#file-kafkaignorefailure-java[Gist], or run it using:"
msgstr "この戦略は link:https://gist.github.com/cescoffier/23ca7b2bcc8c49cee3db29b3f2b59e4a#file-kafkaignorefailure-java[Gistで] 試すこともできるし、Gistを使って実行することもできる："

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:128
#, fuzzy
msgid "If you ran the application and check the log, you will see two exceptions:"
msgstr "アプリケーションを実行してログを確認すると、2つの例外が表示されます："

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:141
#, fuzzy
msgid ""
"Look at the last line.\n"
"As explained, it continues the processing with the next message."
msgstr "最後の行をご覧ください。説明したように、次のメッセージで処理を続けています。"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:144
#, fuzzy
msgid "If you check the health of the application (using http://localhost:8080/health), everything is fine:"
msgstr "アプリケーションの健全性を確認 link:http://localhost:8080/health[（http://localhost:8080/health] を使用）すると、すべて正常です："

#. type: Title ==
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:171
#, fuzzy
msgid "The \"Dead-Letter Topic\" strategy"
msgstr "死語トピック」攻略法"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:173
#, fuzzy
msgid ""
"The https://en.wikipedia.org/wiki/Dead_letter_queue[dead-letter queue] is a well-known pattern to handle message processing failure.\n"
"Instead of failing fast or ignoring and continuing the processing, it stores the failing messages into a specific destination: a dead letter.\n"
"An administrator, human or software, can review the failing messages and decide what can be done (retry, skip, etc.).\n"
"Note that you can only apply this strategy if the ordering is not essential to the application."
msgstr "link:https://en.wikipedia.org/wiki/Dead_letter_queue[デッドレターキューは] 、メッセージ処理の失敗を処理するためのよく知られたパターンです。高速に失敗したり、無視して処理を続行するのではなく、失敗したメッセージを特定の宛先であるデッドレターに格納するのです。人間またはソフトウェアの管理者は、失敗したメッセージを確認し、何ができるか（再試行、スキップなど）を決定することができます。この方法は、順序がアプリケーションに不可欠でない場合のみ適用できることに注意してください。"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:178
#, fuzzy
msgid "You can, later, review the failing messages:"
msgstr "失敗したメッセージは、後で見直すことができます："

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:180
#, fuzzy
msgid "image:/assets/images/posts/kafka-failure-strategy/dead-letter-topic.png[Dead-letter topic]"
msgstr "image:/assets/images/posts/kafka-failure-strategy/dead-letter-topic.png[alt=\"Dead-letter topic\"]"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:182
#, fuzzy
msgid "To enable this strategy, you need to add the following attribute to your configuration:"
msgstr "このストラテジーを有効にするには、次の属性を構成に追加する必要があります："

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:188
#, fuzzy
msgid ""
"By default, it writes to the `dead-letter-topic-$topic-name` topic.\n"
"In our demo, it's `dead-letter-topic-movies`.\n"
"But you can also configure the topic by setting the `dead-letter-queue.topic` attribute."
msgstr "デフォルトでは、 `dead-letter-topic-$topic-name` のトピックに書き込まれます。このデモでは、 `dead-letter-topic-movies` です。しかし、 `dead-letter-queue.topic` 属性を設定することで、トピックを設定することもできます。"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:192
#, fuzzy
msgid "Depending on your Kafka configuration, you may have to create the topic beforehand and configure the replication factor."
msgstr "Kafkaの構成によっては、事前にトピックを作成し、レプリケーションファクターを設定する必要があります。"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:194
#, fuzzy
msgid ""
"Let's try it!\n"
"The https://gist.github.com/cescoffier/23ca7b2bcc8c49cee3db29b3f2b59e4a#file-kafkadeadlettertopic-java[KafkaDeadLetterTopic.java] file extends our previous application.\n"
"It uses the dead-letter-topic failure strategy and contains a component reading the dead-letter topic (`dead-letter-topic-movies`)."
msgstr "試してみましょう！ link:https://gist.github.com/cescoffier/23ca7b2bcc8c49cee3db29b3f2b59e4a#file-kafkadeadlettertopic-java[KafkaDeadLetterTopic.java] ファイルは、前回のアプリケーションを拡張したものです。デッドレタートピックの障害対策として、デッドレタートピック( `dead-letter-topic-movies` )を読み取るコンポーネントを含んでいます。"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:198
#, fuzzy
msgid "You can run the application using:"
msgstr "使用してアプリケーションを実行することができます："

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:205
#, fuzzy
msgid ""
"If you check the log, you will see the two expected exceptions and that all the titles are processed.\n"
"You will also notice:"
msgstr "ログを確認すると、予想された2つの例外があり、すべてのタイトルが処理されていることが確認できます。また、気づくことができます："

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:213
#, fuzzy
msgid "This log is written by the component reading the dead-letter topic:"
msgstr "このログは、デッドレタートピックを読んだコンポーネントが書いたものです："

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:231
#, fuzzy
msgid "When reading messages from the dead-letter topic, you can retrieve the failure reason by reading the `dead-letter-reason` header."
msgstr "デッドレタートピックからメッセージを読み出す場合、 `dead-letter-reason` ヘッダーを読み出すことで、障害理由を取得することができます。"

#. type: Title ==
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:233
msgid "Conclusion"
msgstr "まとめ"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:235
#, fuzzy
msgid "The Kafka connector proposes three strategies to handle failures."
msgstr "Kafkaコネクタは、失敗を処理するために3つの戦略を提案します。"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:237
#, fuzzy
msgid "`fail-fast` (default) stops the application and marks it unhealthy"
msgstr "`fail-fast` (デフォルト) アプリケーションを停止し、不健康な状態にする。"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:238
#, fuzzy
msgid "`ignore` continues the processing even if there are failures."
msgstr "`ignore` は、失敗しても処理を継続します。"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:239
#, fuzzy
msgid "`dead-letter-queue` sends failing messages to another Kafka topic for further investigation."
msgstr "`dead-letter-queue` は、失敗したメッセージを別のKafkaトピックに送り、さらに調査します。"

#. type: Plain Text
#: upstream/_posts/2020-10-20-kafka-failure-strategy.adoc:241
#, fuzzy
msgid ""
"Next time, we will talk about the commit strategies because failures are inevitable, but successful processing happens sometimes!\n"
"Stay tuned!"
msgstr "次回は、失敗は避けられないが、加工が成功することもあるので、コミット戦略についてお話しします！ご期待ください！"
